<?php

/**
 * @file
 * DCloud configuration module.
 */

/**
 * Implements hook_page_attachments().
 *
 * Attach admin branding CSS to all admin pages.
 */
function dc_config_page_attachments(array &$attachments) {
  // Check if we're on an admin route
  $route_match = \Drupal::routeMatch();
  $is_admin = \Drupal::service('router.admin_context')->isAdminRoute($route_match->getRouteObject());

  // Attach admin branding library on admin pages
  if ($is_admin) {
    $attachments['#attached']['library'][] = 'dc_config/admin_branding';
  }
}

/**
 * Implements hook_preprocess_HOOK() for page templates.
 *
 * Set icon_default variable for Gin Login templates.
 */
function dc_config_preprocess_page(&$variables) {
  $route = \Drupal::routeMatch()->getRouteName();

  // Only process login/register/password pages
  if (!in_array($route, ['user.login', 'user.register', 'user.pass'])) {
    return;
  }

  $config = \Drupal::config('gin_login.settings');
  $use_default = $config->get('logo.use_default');
  $logo_path = $config->get('logo.path');

  // Set icon_default for the template
  $variables['icon_default'] = $use_default;

  // Set icon_path if custom logo is configured
  if (!$use_default && !empty($logo_path)) {
    $fileUrlGenerator = \Drupal::service('file_url_generator');
    $variables['icon_path'] = $fileUrlGenerator->generateAbsoluteString($logo_path);
  }
}
